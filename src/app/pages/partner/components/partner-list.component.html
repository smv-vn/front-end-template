<div class="grid">
    <div class="col-12">
        <div class="card px-6 py-6">
            <h2>Danh sách đối tác</h2>

            <!-- Search and Add Section -->
            <div class="formgrid grid mb-4">
                <div class="field col-12 md:col-8">
                    <span class="p-input-icon-left w-full">
                        <i class="pi pi-search"></i>
                        <input
                            type="text"
                            pInputText
                            placeholder="Nhập mã đối tác, tên, số điện thoại..."
                            class="w-full"
                            [value]="searchTerm"
                            (input)="onSearchChange($event)"
                        />
                    </span>
                </div>
                <div class="field col-12 md:col-4 text-right">
                    <p-button
                        *ngIf="searchTerm"
                        icon="pi pi-times"
                        severity="secondary"
                        outlined="true"
                        class="mr-2"
                        (onClick)="clearSearch()"
                        pTooltip="Xóa tìm kiếm"
                    ></p-button>
                    <p-button
                        icon="pi pi-plus"
                        label="Thêm đối tác"
                        (onClick)="openAddDialog()"
                    ></p-button>
                </div>
            </div>

            <!-- Data Table -->
            <p-table
                [value]="partners"
                [loading]="loading"
                [paginator]="true"
                [rows]="10"
                [totalRecords]="totalRecords"
                [showCurrentPageReport]="true"
                currentPageReportTemplate="Hiển thị {first} đến {last} trong tổng số {totalRecords} đối tác"
                [rowsPerPageOptions]="[10, 25, 50]"
                styleClass="p-datatable-gridlines"
                responsiveLayout="scroll"
            >
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 80px">STT</th>
                        <th style="width: 120px">Mã đối tác</th>
                        <th style="min-width: 200px">Tên đối tác</th>
                        <th style="width: 100px">Số khách</th>
                        <th style="width: 140px">Số điện thoại</th>
                        <th style="min-width: 200px">Địa chỉ</th>
                        <th style="width: 200px" class="text-center">
                            Hành động
                        </th>
                    </tr>
                </ng-template>

                <ng-template
                    pTemplate="body"
                    let-partner
                    let-rowIndex="rowIndex"
                >
                    <tr>
                        <td>{{ rowIndex + 1 }}</td>
                        <td>
                            <a
                                href="javascript:void(0)"
                                class="text-primary cursor-pointer"
                                (click)="viewPartnerDetail(partner)"
                            >
                                {{ partner.code }}
                            </a>
                        </td>
                        <td>
                            <div class="flex align-items-center">
                                <p-avatar
                                    [image]="
                                        partner.avatar || getDefaultAvatar()
                                    "
                                    size="normal"
                                    shape="circle"
                                    class="mr-2"
                                ></p-avatar>
                                <span>{{ partner.name }}</span>
                            </div>
                        </td>
                        <td>{{ partner.customerCount }}</td>
                        <td>{{ partner.phone }}</td>
                        <td>{{ partner.address }}</td>
                        <td class="text-center">
                            <p-button
                                icon="pi pi-eye"
                                severity="info"
                                size="small"
                                outlined="true"
                                class="mr-2"
                                pTooltip="Xem chi tiết"
                                (onClick)="viewPartnerDetail(partner)"
                            ></p-button>
                            <p-menu
                                #menu
                                [model]="getMenuItems(partner)"
                                [popup]="true"
                            ></p-menu>

                            <p-button
                                icon="pi pi-ellipsis-v"
                                severity="secondary"
                                size="small"
                                outlined="true"
                                (onClick)="menu.toggle($event)"
                                pTooltip="Thêm tùy chọn"
                            ></p-button>
                        </td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="7" class="text-center py-4">
                            <div class="flex flex-column align-items-center">
                                <i
                                    class="pi pi-info-circle text-4xl text-300 mb-3"
                                ></i>
                                <span class="text-lg text-500">
                                    {{
                                        searchTerm
                                            ? "Không tìm thấy đối tác phù hợp"
                                            : "Chưa có đối tác nào"
                                    }}
                                </span>
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>

<!-- Toast Messages -->
<p-toast></p-toast>

<!-- Confirmation Dialog -->
<p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>
