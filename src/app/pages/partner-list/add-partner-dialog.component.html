<p-dialog
    [(visible)]="visible"
    [modal]="true"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    styleClass="add-partner-dialog"
    header="Thêm đối tác mới"
    [style]="{width: '600px'}"
    (onHide)="onDialogHide()"
>
    <form [formGroup]="partnerForm" (ngSubmit)="onSubmit()" class="partner-form">
        <!-- Avatar Upload Section -->
        <div class="avatar-section mb-4">
            <h4 class="text-lg font-semibold mb-3 text-gray-700">
                <i class="pi pi-image mr-2"></i>
                Ảnh đại diện
            </h4>
            
            <div class="flex align-items-center gap-4">
                <!-- Avatar Preview -->
                <div class="avatar-preview">                    
                    <p-avatar 
                        [image]="previewAvatar || undefined" 
                        [label]="!previewAvatar ? 'NA' : ''"
                        shape="circle" 
                        size="xlarge"
                        [style]="{'width': '80px', 'height': '80px', 'font-size': '1.5rem'}"
                        styleClass="avatar-placeholder"
                    ></p-avatar>
                </div>
                
                <!-- File Upload -->
                <div class="flex-1">
                    <p-fileUpload
                        #fileUpload
                        mode="basic"
                        name="avatar"
                        accept="image/png,image/jpg,image/jpeg,image/svg+xml"
                        [maxFileSize]="5242880"
                        chooseLabel="Chọn ảnh"
                        [auto]="false"
                        [showUploadButton]="false"
                        [showCancelButton]="false"
                        (onSelect)="onFileSelect($event)"
                        (onRemove)="onFileRemove()"
                        styleClass="file-upload-custom"
                    ></p-fileUpload>
                    <small class="text-gray-500 block mt-2">
                        Chấp nhận: PNG, JPG, JPEG, SVG. Tối đa 5MB
                    </small>
                </div>
            </div>
        </div>

        <div class="grid">
            <!-- Tên đối tác -->
            <div class="col-12">
                <div class="field">
                    <label for="partnerName" class="field-label">
                        Tên đối tác <span class="required-asterisk">*</span>
                    </label>
                    <input
                        id="partnerName"
                        type="text"
                        pInputText
                        formControlName="name"
                        placeholder="Nhập tên đối tác..."
                        class="w-full"
                        [class.p-invalid]="formControls['name'].invalid && formControls['name'].touched"
                    />
                    <small 
                        *ngIf="formControls['name'].invalid && formControls['name'].touched"
                        class="error-message"
                    >
                        {{ getFieldError('name') }}
                    </small>
                </div>
            </div>

            <!-- Mã đối tác -->
            <div class="col-12 md:col-6">
                <div class="field">
                    <label for="partnerCode" class="field-label">
                        Mã đối tác <span class="required-asterisk">*</span>
                    </label>
                    <input
                        id="partnerCode"
                        type="text"
                        pInputText
                        formControlName="code"
                        placeholder="VD: PTN001"
                        class="w-full text-uppercase"
                        [class.p-invalid]="formControls['code'].invalid && formControls['code'].touched"
                        style="text-transform: uppercase;"
                    />
                    <small 
                        *ngIf="formControls['code'].invalid && formControls['code'].touched"
                        class="error-message"
                    >
                        {{ getFieldError('code') }}
                    </small>
                </div>
            </div>

            <!-- Số điện thoại -->
            <div class="col-12 md:col-6">
                <div class="field">
                    <label for="partnerPhone" class="field-label">
                        Số điện thoại <span class="required-asterisk">*</span>
                    </label>
                    <input
                        id="partnerPhone"
                        type="tel"
                        pInputText
                        formControlName="phone"
                        placeholder="0901234567"
                        class="w-full"
                        [class.p-invalid]="formControls['phone'].invalid && formControls['phone'].touched"
                    />
                    <small 
                        *ngIf="formControls['phone'].invalid && formControls['phone'].touched"
                        class="error-message"
                    >
                        {{ getFieldError('phone') }}
                    </small>
                </div>
            </div>

            <!-- Địa chỉ -->
            <div class="col-12">
                <div class="field">
                    <label for="partnerAddress" class="field-label">
                        Địa chỉ <span class="required-asterisk">*</span>
                    </label>
                    <textarea
                        id="partnerAddress"
                        pInputTextarea
                        formControlName="address"
                        placeholder="Nhập địa chỉ đầy đủ..."
                        class="w-full"
                        rows="3"
                        [class.p-invalid]="formControls['address'].invalid && formControls['address'].touched"
                    ></textarea>
                    <small 
                        *ngIf="formControls['address'].invalid && formControls['address'].touched"
                        class="error-message"
                    >
                        {{ getFieldError('address') }}
                    </small>
                </div>
            </div>

            <!-- Mô tả -->
            <div class="col-12">
                <div class="field">
                    <label for="partnerDescription" class="field-label">
                        Mô tả
                    </label>
                    <textarea
                        id="partnerDescription"
                        pInputTextarea
                        formControlName="description"
                        placeholder="Mô tả thêm về đối tác (tùy chọn)..."
                        class="w-full"
                        rows="3"
                    ></textarea>
                    <small 
                        *ngIf="formControls['description'].invalid && formControls['description'].touched"
                        class="error-message"
                    >
                        {{ getFieldError('description') }}
                    </small>
                </div>
            </div>
        </div>
    </form>

    <ng-template pTemplate="footer">
        <div class="flex justify-content-end gap-2">
            <button
                pButton
                type="button"
                label="Hủy"
                icon="pi pi-times"
                class="p-button-outlined p-button-secondary"
                (click)="closeDialog()"
                [disabled]="isSubmitting"
            ></button>
            <button
                pButton
                type="submit"
                label="Thêm đối tác"
                icon="pi pi-plus"
                class="p-button-primary"
                (click)="onSubmit()"
                [disabled]="isSubmitting"
                [loading]="isSubmitting"
            ></button>
        </div>
    </ng-template>
</p-dialog>

<!-- Toast for notifications -->
<p-toast position="top-right"></p-toast>
